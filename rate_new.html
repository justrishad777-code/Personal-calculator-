<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold App - Rate F</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1d24">

    <style>
        body {
            background-color: #222831;
            color: #eeeeee;
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 50px;
        }
        /* Header */
        .header {
            background: #1a1d24;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header h3 { margin: 0; font-size: 18px; }
        .home-btn { text-decoration: none; color: #ffaf40; font-weight: bold; }

        /* Container */
        .container { padding: 15px; }

        /* Card */
        .card {
            background: #393e46;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        /* Inputs */
        label { display: block; font-size: 12px; color: #adb5bd; margin-bottom: 5px; }
        input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            background: #222831;
            border: 1px solid #4b5563;
            color: #fff;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }
        input:focus { outline: 2px solid #ffaf40; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn {
            flex: 1; padding: 10px; border: none; border-radius: 5px;
            background: #222831; color: #aaa; font-weight: bold;
        }
        .tab-btn.active { background: #ffaf40; color: #000; }

        /* Grid */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* Result Box */
        .result-box {
            background: #222831; padding: 15px; border-radius: 8px;
            text-align: center; margin-top: 10px; border: 1px solid #555;
        }
        .result-val { font-size: 24px; font-weight: bold; color: #ffaf40; }

        /* Action Button */
        .btn-main {
            width: 100%; padding: 15px; background: #fff; color: #000;
            border: none; border-radius: 8px; font-size: 16px; font-weight: bold;
            margin-top: 20px; cursor: pointer;
        }

        /* INVOICE PREVIEW (Hidden initially) */
        #invoice-view {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; color: #000; z-index: 2000;
            overflow-y: auto; padding: 20px; box-sizing: border-box;
        }
        
        .inv-header { background: #000; color: #fff; padding: 15px; text-align: center; margin-bottom: 20px; }
        .inv-row { display: flex; justify-content: space-between; border-bottom: 1px solid #ccc; padding: 8px 0; font-size: 14px; font-weight: bold; }
        .close-btn {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #ff4757; color: white; padding: 10px 30px; border-radius: 25px; border: none; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="app-view">
        <div class="header">
            <h3>Rate F</h3>
            <a href="index.html" class="home-btn">Home üè†</a>
        </div>

        <div class="container">
            <div class="card">
                <label>Screen Rate (Oz)</label>
                <input type="number" id="screenRate" placeholder="0000" oninput="calc()">

                <div class="tabs">
                    <button class="tab-btn active">22K / 21K Calculator</button>
                </div>

                <div style="text-align:center; color:#ffaf40; font-weight:bold; margin-bottom:10px;">22 Karat (92.6%)</div>
                
                <div class="grid-2">
                    <div><label>MC</label><input type="number" id="mc22" placeholder="MC" oninput="calc()"></div>
                    <div><label>Dh</label><input type="number" id="dh22" placeholder="Dh" oninput="calc()"></div>
                    <div><label>CR</label><input type="number" id="cr22" placeholder="CR" oninput="calc()"></div>
                    <div><label>MG</label><input type="number" id="mg22" placeholder="MG" oninput="calc()"></div>
                </div>

                <div class="result-box">
                    <div style="font-size:12px; color:#aaa;">1 Bhori Rate</div>
                    <div id="rate22" class="result-val">0.00</div>
                </div>

                <label style="margin-top:15px;">Weight (gm)</label>
                <input type="number" id="w22" placeholder="Enter Weight" style="font-size:24px;" oninput="calc()">

                <div class="result-box" style="border-color:#ffaf40;">
                    <div style="font-size:12px; color:#aaa;">TOTAL PRICE</div>
                    <div id="total22" class="result-val" style="font-size:30px;">0.00</div>
                </div>

                <div style="margin-top:20px;">
                    <input type="text" id="cName" placeholder="Customer Name">
                    <input type="text" id="authName" placeholder="Authorized By">
                </div>

                <button class="btn-main" onclick="showInvoice()">üìÑ SHOW INVOICE</button>
            </div>
        </div>
    </div>

    <div id="invoice-view">
        <div class="inv-header">
            <h1 style="margin:0;">INVOICE</h1>
            <small>Computer Generated Receipt</small>
        </div>

        <div style="display:flex; justify-content:space-between; margin-bottom:20px; font-weight:bold;">
            <div>
                CUSTOMER: <span id="inv-name" style="font-weight:normal">Guest</span><br>
                DATE: <span id="inv-date" style="font-weight:normal">--</span>
            </div>
            <div style="text-align:right;">
                AUTH BY: <span id="inv-auth" style="font-weight:normal">Admin</span>
            </div>
        </div>

        <div style="border-top: 2px solid #000; border-bottom: 2px solid #000;">
            <div class="inv-row" style="background:#ddd;">
                <span>ITEM</span> <span>RATE</span> <span>WT(g)</span> <span>TOTAL</span>
            </div>
            <div class="inv-row" id="inv-item-row">
                <span>22K GOLD</span> <span id="inv-rate">0</span> <span id="inv-wt">0</span> <span id="inv-total">0</span>
            </div>
        </div>

        <div style="margin-top:20px; text-align:right; font-size:20px; font-weight:bold; background:#000; color:#fff; padding:10px;">
            GRAND TOTAL: <span id="inv-grand">0.00</span>
        </div>

        <div style="text-align:center; margin-top:50px; font-size:12px; font-weight:bold;">
            THANK YOU FOR YOUR BUSINESS
        </div>

        <button class="close-btn" onclick="closeInvoice()">CLOSE ‚úñ</button>
    </div>

    <script>
        // SERVICE WORKER UPDATE (V20)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('./service-worker.js'); });
        }

        function calc() {
            // Get Values
            let b = parseFloat(document.getElementById('screenRate').value) || 0;
            let mc = parseFloat(document.getElementById('mc22').value) || 0;
            let dh = parseFloat(document.getElementById('dh22').value) || 0;
            let cr = parseFloat(document.getElementById('cr22').value) || 0;
            let mg = parseFloat(document.getElementById('mg22').value) || 0;
            let w = parseFloat(document.getElementById('w22').value) || 0;

            // 22K (92.6%) Logic
            let rate = (((b * 3.674 / 31.1035 * 0.926) + mc) * 11.664 * dh) + cr + mg;
            let total = rate * (w / 11.664);

            // Update UI
            document.getElementById('rate22').innerText = rate.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
            document.getElementById('total22').innerText = total.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
        }

        function showInvoice() {
            // Transfer Data
            document.getElementById('inv-name').innerText = document.getElementById('cName').value || 'Guest';
            document.getElementById('inv-auth').innerText = document.getElementById('authName').value || 'Admin';
            document.getElementById('inv-date').innerText = new Date().toLocaleDateString();
            
            document.getElementById('inv-rate').innerText = document.getElementById('rate22').innerText;
            document.getElementById('inv-wt').innerText = document.getElementById('w22').value;
            document.getElementById('inv-total').innerText = document.getElementById('total22').innerText;
            document.getElementById('inv-grand').innerText = document.getElementById('total22').innerText;

            // Show Invoice, Hide App
            document.getElementById('app-view').style.display = 'none';
            document.getElementById('invoice-view').style.display = 'block';
        }

        function closeInvoice() {
            document.getElementById('invoice-view').style.display = 'none';
            document.getElementById('app-view').style.display = 'block';
        }
    </script>
</body>
</html>
