<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Settings</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="theme-color" content="#1a1d24">

    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- DARK COMFORT THEME DEFAULTS --- */
        :root { 
            --primary: #ffaf40;    
            --secondary: #48dbfb;  
            --bg-color: #222831;   
            --card-bg: #393e46;    
            --text-main: #eeeeee;  
            --border: #4b5563;     
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; 
            font-family: 'Segoe UI', sans-serif; 
            background: var(--bg-color); 
            color: var(--text-main);
            display: flex; flex-direction: column; height: 100vh;
            padding-top: env(safe-area-inset-top);
        }

        /* HEADER */
        .header {
            height: 60px; background: #1a1d24; 
            display: flex; align-items: center; padding: 0 20px;
            border-bottom: 1px solid #333; justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 100; flex-shrink: 0;
        }
        .menu-icon { font-size: 24px; cursor: pointer; color: #fff; width: 40px; }
        .logo-img { height: 35px; }

        /* MENU POPUP */
        #menuPopup {
            display: none; position: absolute; top: 60px; left: 10px; width: 220px;
            background: #393e46; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            z-index: 2000; flex-direction: column; border: 1px solid #555; overflow: hidden;
        }
        .menu-item { 
            padding: 15px; text-decoration: none; color: #eee; 
            border-bottom: 1px solid #555; font-weight: 600; display: flex; align-items: center; cursor: pointer;
        }
        .menu-item:hover { background: #444; }
        .menu-icon-span { margin-right: 12px; font-size: 18px; }

        /* CONTENT */
        .content { flex: 1; padding: 20px; overflow-y: auto; }
        .card {
            background: var(--card-bg); border-radius: 15px; padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); margin-bottom: 20px;
        }

        /* COLOR PICKER ROWS */
        .color-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 0; border-bottom: 1px solid #555;
        }
        .color-inp {
            border: none; width: 40px; height: 40px; cursor: pointer; background: transparent; padding: 0;
        }
        
        /* BUTTONS */
        .btn-action {
            width: 100%; padding: 15px; background: #fff; color: #333;
            border: none; border-radius: 10px; font-size: 16px; font-weight: bold;
            margin-top: 10px; cursor: pointer; transition: 0.2s;
        }
        .btn-action:active { transform: scale(0.98); }
        .btn-danger { background: #ff6b6b; color: #fff; }

        /* INSTALL BUTTON (Hidden by default) */
        #installBtn { display: none; background: var(--primary); color: #222; }
    </style>
</head>
<body onload="loadSettings()">

    <div class="header">
        <div class="menu-icon" onclick="toggleMenu()">‚ò∞</div>
        <span style="font-size:20px; font-weight:bold;">Settings</span>
        <img src="logo.png" alt="Logo" class="logo-img">
    </div>

    <div id="menuPopup">
        <button id="installBtn" class="menu-item"><span class="menu-icon-span">‚¨áÔ∏è</span> Install App</button>
        
        <a href="index.html" class="menu-item"><span class="menu-icon-span">üè†</span> Dashboard</a>
        <a href="rate.html" class="menu-item"><span class="menu-icon-span">üìù</span> Rate F</a>
        <a href="converter.html" class="menu-item"><span class="menu-icon-span">‚öñÔ∏è</span> Converter</a>
        <a href="casio.html" class="menu-item"><span class="menu-icon-span">üî¢</span> Casio Calc</a>
        <a href="settings.html" class="menu-item" style="background:#444;"><span class="menu-icon-span">‚öôÔ∏è</span> Settings</a>
    </div>

    <div class="content">
        <div class="card">
            <h3 style="margin-top:0; color:var(--primary); border-bottom:1px solid #555; padding-bottom:10px;">üé® App Theme</h3>
            
            <div class="color-row">
                <span>Primary Color</span>
                <input type="color" class="color-inp" id="clr-primary" value="#ffaf40" onchange="updateVar('--primary', this.value)">
            </div>
            <div class="color-row">
                <span>Secondary Color</span>
                <input type="color" class="color-inp" id="clr-secondary" value="#48dbfb" onchange="updateVar('--secondary', this.value)">
            </div>
            <div class="color-row">
                <span>Background</span>
                <input type="color" class="color-inp" id="clr-bg" value="#222831" onchange="updateVar('--bg-color', this.value)">
            </div>
            <div class="color-row">
                <span>Card Background</span>
                <input type="color" class="color-inp" id="clr-card" value="#393e46" onchange="updateVar('--card-bg', this.value)">
            </div>
            <div class="color-row">
                <span>Text Color</span>
                <input type="color" class="color-inp" id="clr-text" value="#eeeeee" onchange="updateVar('--text-main', this.value)">
            </div>

            <button class="btn-action" style="background:#555; color:#fff; margin-top:20px;" onclick="resetTheme()">Rest Default Theme</button>
        </div>

        <div class="card">
            <h3 style="margin-top:0; color:var(--secondary); border-bottom:1px solid #555; padding-bottom:10px;">üõ†Ô∏è Maintenance</h3>
            <p style="font-size:13px; color:#aaa;">If the app feels slow or doesn't update, try clearing the cache.</p>
            <button class="btn-action btn-danger" onclick="clearCache()">Clear App Cache & Reload</button>
            <div style="margin-top:15px; text-align:center; color:#666; font-size:12px;">App Version 2.0 (PWA Enabled)</div>
        </div>
    </div>

    <script>
        // 1. SERVICE WORKER REGISTRATION
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js');
            });
        }

        // 2. MENU LOGIC
        function toggleMenu() {
            const m = document.getElementById('menuPopup');
            m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
        }
        window.addEventListener('click', function(e) {
            const m = document.getElementById('menuPopup');
            const btn = document.querySelector('.menu-icon');
            if (e.target !== m && e.target !== btn && !m.contains(e.target)) {
                m.style.display = 'none';
            }
        });

        // 3. THEME LOGIC
        function updateVar(variable, value) {
            document.documentElement.style.setProperty(variable, value);
            saveTheme();
        }

        function saveTheme() {
            const theme = {
                primary: document.documentElement.style.getPropertyValue('--primary'),
                secondary: document.documentElement.style.getPropertyValue('--secondary'),
                bg: document.documentElement.style.getPropertyValue('--bg-color'),
                card: document.documentElement.style.getPropertyValue('--card-bg'),
                text: document.documentElement.style.getPropertyValue('--text-main')
            };
            localStorage.setItem('gold_theme', JSON.stringify(theme));
        }

        function loadSettings() {
            const t = JSON.parse(localStorage.getItem('gold_theme') || '{}');
            if (t.primary) {
                document.documentElement.style.setProperty('--primary', t.primary);
                document.getElementById('clr-primary').value = t.primary.trim();
            }
            if (t.secondary) {
                document.documentElement.style.setProperty('--secondary', t.secondary);
                document.getElementById('clr-secondary').value = t.secondary.trim();
            }
            if (t.bg) {
                document.documentElement.style.setProperty('--bg-color', t.bg);
                document.getElementById('clr-bg').value = t.bg.trim();
            }
            if (t.card) {
                document.documentElement.style.setProperty('--card-bg', t.card);
                document.getElementById('clr-card').value = t.card.trim();
            }
            if (t.text) {
                document.documentElement.style.setProperty('--text-main', t.text);
                document.getElementById('clr-text').value = t.text.trim();
            }
        }

        function resetTheme() {
            localStorage.removeItem('gold_theme');
            location.reload();
        }

        // 4. CLEAR CACHE LOGIC
        function clearCache() {
            if ('caches' in window) {
                caches.keys().then((names) => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                }).then(() => {
                    alert('Cache Cleared! Reloading...');
                    window.location.reload(true);
                });
            } else {
                alert('Cache not supported in this browser.');
            }
        }

        // 5. INSTALL LOGIC
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex'; // Show in menu
        });

        installBtn.addEventListener('click', (e) => {
            installBtn.style.display = 'none';
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                });
            }
        });
    </script>
</body>
</html>
