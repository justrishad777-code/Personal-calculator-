<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold App Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.cdnfonts.com/css/digital-7-mono" rel="stylesheet">

    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --primary: #ff9f43;       
            --secondary: #0abde3;     
            --bg-color: #f4f7f6;      
            --card-bg: #ffffff;       
            --text-main: #333333;     
            --text-light: #777777;    
            --border: #dddddd;        
            --header-bg: #ffffff;     
        }

        /* --- GLOBAL RESET & FIX --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        input { user-select: text !important; -webkit-user-select: text !important; }
        
        /* Stop bouncy scrolling globally */
        html, body {
            height: 100%; width: 100%; margin: 0; padding: 0;
            overflow: hidden; position: fixed; /* Locks viewport */
            font-family: 'Segoe UI', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main);
            touch-action: manipulation;
        }

        .app-container { 
            width: 100%; max-width: 450px; height: 100%; margin: 0 auto;
            display: flex; flex-direction: column; position: relative;
        }
        
        /* HEADER (Logo Centered) */
        .header { 
            display: flex; justify-content: space-between; align-items: center; 
            background: var(--header-bg); padding: 10px 15px; 
            border-bottom: 1px solid var(--border);
            height: 60px; flex-shrink: 0; z-index: 500;
        }
        .logo-img { height: 35px; display: block; margin: 0 auto; }
        .menu-icon { font-size: 24px; color: var(--text-main); cursor: pointer; width: 40px; text-align: left; }
        
        /* MENU POPUP */
        #menuPopup { 
            display: none; position: absolute; top: 60px; left: 10px; width: 200px; 
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; 
            padding: 8px; z-index: 3000; box-shadow: 0 5px 20px rgba(0,0,0,0.15); 
            flex-direction: column; gap: 5px;
        }
        .menu-btn { 
            background: var(--bg-color); color: var(--text-main); padding: 12px; 
            border-radius: 6px; border: none; font-size: 14px; font-weight: 600; 
            text-align: left; cursor: pointer; 
        }

        /* --- PAGE STRUCTURE --- */
        /* Scrollable Page: Default padding small to prevent moving */
        .scrollable-page {
            flex: 1; overflow-y: auto; padding: 15px; 
            padding-bottom: 20px; /* FIXED: Removed large padding */
            display: none; flex-direction: column;
            -webkit-overflow-scrolling: touch;
            transition: padding-bottom 0.3s; /* Smooth transition for keypad */
        }
        
        /* Fixed Page (Casio): Never scrolls */
        .fixed-page {
            flex: 1; overflow: hidden; padding: 0; 
            display: none; flex-direction: column; background: #000;
        }

        .active { display: flex !important; }

        /* --- CASIO STYLES --- */
        .casio-screen { flex: 1; background: #000; border-bottom: 1px solid #222; display: flex; flex-direction: column; padding: 15px; position: relative; }
        .casio-indicators { display: flex; justify-content: space-between; align-items: center; height: 30px; }
        .casio-step { font-family: 'Courier New', monospace; font-size: 18px; color: var(--secondary); border: 1px solid #333; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .casio-mode { font-size: 14px; font-weight: bold; color: var(--primary); display: none; }
        .casio-op { text-align: right; font-family: 'Digital-7 Mono', monospace; font-size: 35px; color: var(--primary); height: 40px; margin-top: 5px; }
        .casio-main-box { flex: 1; display: flex; align-items: flex-end; justify-content: flex-end; overflow: hidden; }
        .casio-main-text { font-family: 'Digital-7 Mono', monospace; color: #fff; font-size: 80px; line-height: 1; white-space: nowrap; }
        
        .casio-controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 15px; background: var(--bg-color); flex-shrink: 0; }
        .casio-c-btn { background: var(--card-bg); color: var(--text-light); border: 1px solid var(--border); padding: 15px; border-radius: 12px; font-size: 15px; font-weight: bold; box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
        .casio-chk { color: var(--secondary); } .casio-corr { color: var(--primary); }

        .casio-keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 10px 15px 25px; background: var(--bg-color); flex-shrink: 0; }
        .casio-k-btn { height: 65px; width: 100%; border-radius: 18px; border: 1px solid var(--border); font-size: 30px; font-weight: bold; color: var(--text-main); background: var(--card-bg); box-shadow: 0 4px 0 rgba(0,0,0,0.1); }
        .casio-k-btn:active { transform: translateY(4px); box-shadow: none; }
        .casio-ac { color: #ff6b6b; } .casio-btn-op { color: var(--primary); } .casio-eq { background: var(--primary); color: #fff; box-shadow: 0 4px 0 rgba(0,0,0,0.2); border:none; }

        .casio-drawer { position: absolute; bottom: -100%; left: 0; width: 100%; height: 75%; background: #111; border-top: 1px solid #333; border-radius: 25px 25px 0 0; z-index: 200; transition: bottom 0.3s; display: flex; flex-direction: column; }
        .casio-drawer.open { bottom: 0; }
        .casio-d-row { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding: 10px; color: #aaa; font-family: monospace; font-size: 14px; }
        .casio-d-row b { color: #fff; font-size: 16px; }

        /* --- RATE F & CONVERTER --- */
        .card { background: var(--card-bg); padding: 20px; border-radius: 20px; border: 1px solid var(--border); margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); width: 100%; }
        .main-input { width: 100%; padding: 15px; margin-bottom: 15px; background: var(--bg-color); border: 2px solid var(--border); border-radius: 12px; font-size: 32px; color: var(--text-main); text-align: center; font-weight: bold; outline: none; }
        .main-input:focus, .active-field { border-color: var(--primary); background: var(--card-bg); }
        
        .tab-box { display: flex; gap: 8px; margin-bottom: 20px; background: var(--bg-color); padding: 5px; border-radius: 30px; }
        .t-btn { background: transparent; color: var(--text-light); border: none; padding: 10px; border-radius: 25px; font-size: 12px; font-weight: bold; flex: 1; cursor: pointer; }
        .t-btn.active-22 { background: var(--primary); color: #fff; }
        .t-btn.active-21 { background: var(--secondary); color: #fff; }
        .t-btn.active-both { background: #ffd700; color: #000; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .small-input { width: 100%; padding: 14px; background: var(--bg-color); border: 1px solid var(--border); border-radius: 10px; color: var(--text-main); text-align: center; font-weight: bold; outline: none; }
        .small-input:focus, .active-field { border-color: var(--primary); background: var(--card-bg); }
        .weight-input { width: 100%; padding: 18px; background: var(--bg-color); border: 2px solid var(--border); border-radius: 12px; color: var(--text-main); text-align: center; font-size: 26px; font-weight: bold; outline: none; }
        .weight-input:focus, .active-field { border-color: var(--primary); background: var(--card-bg); }
        .sec-22 { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 20px; }
        .sec-21 { border-left: 5px solid var(--secondary); padding-left: 15px; margin-bottom: 20px; }
        .hidden { display: none; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; font-size: 15px; color: var(--text-light); }
        .btn-action { width: 100%; padding: 16px; background: #28a745; color: #fff; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; margin-top: 15px; cursor: pointer; }

        /* POPUP KEYPAD */
        #customKeypad { position: fixed; bottom: -100%; left: 0; width: 100%; background: var(--card-bg); border-top: 1px solid var(--border); border-radius: 25px 25px 0 0; padding: 20px 15px; transition: bottom 0.2s ease-out; z-index: 5000; box-shadow: 0 -5px 30px rgba(0,0,0,0.1); }
        #customKeypad.show { bottom: 0; }
        .keypad-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 5px; }
        .k-btn { background: var(--bg-color); border: 1px solid var(--border); color: var(--text-main); font-size: 24px; font-weight: 700; padding: 15px 0; border-radius: 12px; cursor: pointer; }
        .k-btn:active { background: var(--primary); color: #fff; }
        .k-close { grid-column: span 3; background: #fff0f0; border: 1px solid #ffcccc; color: #ff4d4d; font-size: 16px; padding: 10px; margin-bottom: 10px; }

        /* CONVERTER */
        .conv-box { background: var(--card-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border); }
        .conv-inp { width: 100%; background: transparent; border: none; color: var(--text-main); font-size: 22px; font-weight: bold; text-align: center; outline: none; }
        .conv-lbl { font-size: 10px; color: var(--text-light); margin-top: 5px; text-transform: uppercase; display: block; letter-spacing: 1px; }

        /* SETTINGS */
        .color-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .color-inp { width: 40px; height: 40px; border: none; background: none; cursor: pointer; }
    </style>
</head>
<body onload="init()">

<div class="app-container">
    <div class="header">
        <div class="menu-icon" onclick="toggleMenu()">â˜°</div>
        <img src="logo.png" alt="Logo" class="logo-img">
        <div style="width:40px;"></div>
    </div>

    <div id="menuPopup">
        <button class="menu-btn" onclick="showPage('page-ratef'); toggleMenu()">Rate F</button>
        <button class="menu-btn" onclick="showPage('page-converter'); toggleMenu()">Weight Converter</button>
        <button class="menu-btn" onclick="showPage('page-settings'); toggleMenu()">Settings</button>
        <button class="menu-btn" onclick="showPage('page-casio'); toggleMenu(); casio_init()">Casio Calculator</button>
    </div>

    <div id="page-casio" class="fixed-page active">
        <div class="casio-screen">
            <div class="casio-indicators">
                <div class="casio-step" id="cStep">00</div>
                <div class="casio-mode" id="cMode">REVIEW</div>
            </div>
            <div class="casio-op" id="cOp"></div>
            <div class="casio-main-box">
                <div class="casio-main-text" id="cMain">0</div>
            </div>
        </div>

        <div class="casio-controls">
            <button class="casio-c-btn casio-chk" onclick="casio_prev()">â—€ PREV</button>
            <button class="casio-c-btn casio-chk" onclick="casio_next()">NEXT â–¶</button>
            <button class="casio-c-btn" onclick="casio_toggleDrawer()">ðŸ“œ List</button>
            <button class="casio-c-btn casio-corr" onclick="casio_correct()">CORR</button>
        </div>

        <div class="casio-keypad">
            <button class="casio-k-btn casio-ac" onclick="casio_AC()">AC</button>
            <button class="casio-k-btn casio-btn-op" onclick="casio_del()">âŒ«</button>
            <button class="casio-k-btn casio-btn-op" onclick="casio_op('%')">%</button>
            <button class="casio-k-btn casio-btn-op" onclick="casio_op('/')">Ã·</button>

            <button class="casio-k-btn" onclick="casio_num('7')">7</button>
            <button class="casio-k-btn" onclick="casio_num('8')">8</button>
            <button class="casio-k-btn" onclick="casio_num('9')">9</button>
            <button class="casio-k-btn casio-btn-op" onclick="casio_op('*')">Ã—</button>

            <button class="casio-k-btn" onclick="casio_num('4')">4</button>
            <button class="casio-k-btn" onclick="casio_num('5')">5</button>
            <button class="casio-k-btn" onclick="casio_num('6')">6</button>
            <button class="casio-k-btn casio-btn-op" onclick="casio_op('-')">âˆ’</button>

            <button class="casio-k-btn" onclick="casio_num('1')">1</button>
            <button class="casio-k-btn" onclick="casio_num('2')">2</button>
            <button class="casio-k-btn" onclick="casio_num('3')">3</button>
            <button class="casio-k-btn casio-btn-op" onclick="casio_op('+')">+</button>

            <button class="casio-k-btn" onclick="casio_num('00')">00</button>
            <button class="casio-k-btn" onclick="casio_num('0')">0</button>
            <button class="casio-k-btn" onclick="casio_num('.')">.</button>
            <button class="casio-k-btn casio-eq" onclick="casio_eq()">=</button>
        </div>

        <div class="casio-drawer" id="casioDrawer">
            <div style="padding:15px; border-bottom:1px solid #333; display:flex; justify-content:space-between; color:#fff;">
                <span>History Tape</span>
                <span onclick="casio_toggleDrawer()" style="cursor:pointer;color:#ff6b6b;">âœ•</span>
            </div>
            <div style="flex:1; overflow-y:auto; padding:15px;" id="casioListBody"></div>
        </div>
    </div>

    <div id="page-ratef" class="scrollable-page">
        <div class="card">
            <label style="font-size:11px; color:var(--text-light);">Screen Rate</label>
            <input type="text" inputmode="none" readonly id="screenRate" class="main-input" placeholder="0.00" onclick="focusField(this)">

            <div class="tab-box">
                <button class="t-btn" id="b22" onclick="setTab('22')">22K Only</button>
                <button class="t-btn" id="b21" onclick="setTab('21')">21K Only</button>
                <button class="t-btn active-both" id="bBoth" onclick="setTab('both')">Both</button>
            </div>

            <div id="sec22" class="sec-22">
                <div class="row"><span style="color:var(--primary); font-weight:bold;">22 Karat (92.6%)</span></div>
                <div class="grid-2">
                    <input type="text" inputmode="none" readonly id="mc22" class="small-input" placeholder="MC" onclick="focusField(this)">
                    <input type="text" inputmode="none" readonly id="dh22" class="small-input" placeholder="Dh" onclick="focusField(this)">
                    <input type="text" inputmode="none" readonly id="cr22" class="small-input" placeholder="CR" onclick="focusField(this)">
                    <input type="text" inputmode="none" readonly id="mg22" class="small-input" placeholder="MG" onclick="focusField(this)">
                </div>
                <input type="text" inputmode="none" readonly id="w22" class="weight-input" placeholder="Weight (gm)" onclick="focusField(this)">
                <div class="row"><span>Rate Per Bhori</span> <span id="r22" style="font-weight:bold; color:var(--text-main);">0.00</span></div>
                <div class="row"><span style="color:var(--primary); font-weight:900;">Total</span> <span id="t22" style="font-size:28px; font-weight:900; color:var(--primary);">0.00</span></div>
            </div>

            <div id="sec21" class="sec-21 hidden">
                <div class="row"><span style="color:var(--secondary); font-weight:bold;">21 Karat (88.5%)</span></div>
                <div class="grid-2">
                    <input type="text" inputmode="none" readonly id="mc21" class="small-input" placeholder="MC" onclick="focusField(this)">
                    <input type="text" inputmode="none" readonly id="dh21" class="small-input" placeholder="Dh" onclick="focusField(this)">
                    <input type="text" inputmode="none" readonly id="cr21" class="small-input" placeholder="CR" onclick="focusField(this)">
                    <input type="text" inputmode="none" readonly id="mg21" class="small-input" placeholder="MG" onclick="focusField(this)">
                </div>
                <input type="text" inputmode="none" readonly id="w21" class="weight-input" placeholder="Weight (gm)" onclick="focusField(this)">
                <div class="row"><span>Rate Per Bhori</span> <span id="r21" style="font-weight:bold; color:var(--text-main);">0.00</span></div>
                <div class="row"><span style="color:var(--secondary); font-weight:900;">Total</span> <span id="t21" style="font-size:28px; font-weight:900; color:var(--secondary);">0.00</span></div>
            </div>

            <div style="background:var(--bg-color); padding:15px; border-radius:15px; text-align:center; border:1px solid var(--border);">
                <div id="grandTotal" style="font-size:36px; font-weight:900; color:var(--text-main);">0.00</div>
            </div>

            <div style="margin-top:20px;">
                <input id="cName" style="width:100%; padding:12px; margin-bottom:10px; background:var(--bg-color); border:1px solid var(--border); border-radius:8px; color:var(--text-main);" placeholder="Customer Name">
                <input id="authName" style="width:100%; padding:12px; background:var(--bg-color); border:1px solid var(--border); border-radius:8px; color:var(--text-main);" placeholder="Authorized By">
            </div>
            <button class="btn-action" onclick="downloadPDF('invoice')">DOWNLOAD INVOICE</button>
        </div>
    </div>

    <div id="page-converter" class="scrollable-page">
        <div class="card" style="text-align:center;">
            <h4 style="color:var(--primary); margin-bottom:15px; letter-spacing:2px; font-weight:900;">WEIGHT CONVERTER</h4>
            <input type="text" inputmode="none" readonly id="cv_g" class="main-input" placeholder="Grams" onclick="focusField(this)">
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin:20px 0;">
                <div class="conv-box"><input type="text" inputmode="none" readonly id="res_v" class="conv-inp" placeholder="0" onclick="focusField(this)"><span class="conv-lbl">Vori</span></div>
                <div class="conv-box"><input type="text" inputmode="none" readonly id="res_a" class="conv-inp" placeholder="0" onclick="focusField(this)"><span class="conv-lbl">Ana</span></div>
                <div class="conv-box"><input type="text" inputmode="none" readonly id="res_r" class="conv-inp" placeholder="0" onclick="focusField(this)"><span class="conv-lbl">Ratti</span></div>
            </div>
            <button class="btn-action" onclick="downloadPDF('converter')">DOWNLOAD REPORT</button>
        </div>
    </div>

    <div id="page-settings" class="scrollable-page">
        <div class="card">
            <h4 style="margin-top:0; color:var(--primary);">Theme Colors</h4>
            <div class="color-row"><span>Primary Color</span><input type="color" class="color-inp" id="clr-primary" value="#ff9f43" onchange="updateTheme('primary', this.value)"></div>
            <div class="color-row"><span>Secondary Color</span><input type="color" class="color-inp" id="clr-secondary" value="#0abde3" onchange="updateTheme('secondary', this.value)"></div>
            <div class="color-row"><span>Background</span><input type="color" class="color-inp" id="clr-bg" value="#f4f7f6" onchange="updateTheme('bg', this.value)"></div>
            <div class="color-row"><span>Card Background</span><input type="color" class="color-inp" id="clr-card" value="#ffffff" onchange="updateTheme('card', this.value)"></div>
            <div class="color-row"><s