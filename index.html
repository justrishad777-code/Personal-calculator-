<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold Pro | Ultimate Fixed Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --bg-body: #050505;
            --bg-card: rgba(25, 25, 25, 0.85);
            --bg-input: rgba(0, 0, 0, 0.6);
            --border-color: rgba(255, 255, 255, 0.12);
            --text-main: #ffffff;
            --text-sub: #aaaaaa;
            --color-22k: #ffd700;
            --color-21k: #00a2ff;
            --accent-color: #ff8c00;
            --header-bg: rgba(20, 20, 20, 0.9);
            --btn-bg: #1db954;
            --glass-blur: blur(15px);
        }
        html, body { height: 100%; width: 100%; overflow: hidden; position: fixed; margin: 0; background: #000; touch-action: none; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); color: var(--text-main); display: flex; justify-content: center; }
        .app-container { 
            width: 100%; max-width: 450px; height: 100%; padding: 15px; 
            display: flex; flex-direction: column; overflow-y: auto;
            transition: padding-bottom 0.3s ease;
            touch-action: pan-y;
        }
        .app-container.keypad-active { padding-bottom: 420px; }
        /* ... remaining CSS unchanged ... */
    </style>
</head>
<body onload="initApp()">

<div class="overlay" id="overlay" onclick="window.toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <div style="color:var(--accent-color); font-weight:800; margin-bottom:20px; border-bottom:1px solid #333; padding-bottom:10px;">GOLD TOOLS</div>
    <button class="menu-item" onclick="window.switchPage('converter')">‚öñÔ∏è Weight Converter</button>
    <button class="menu-item" onclick="window.switchPage('gRateW')">üßÆ Price Calculator</button>
    <div style="margin-top: auto;"><button class="menu-item" onclick="window.openAdmin()">üé® Theme Settings</button></div>
</div>

<div class="app-container" id="appMain">
    <div class="header"><button class="plus-btn" onclick="window.toggleSidebar()">+</button><div class="logo-middle"><img src="./logo.png" alt="Logo"></div></div>

    <div id="page_converter" class="page-section active">
        <div class="card">
            <div class="main-title">WEIGHT CONVERTER</div>
            <input type="text" id="gramInput" class="big-input use-keypad" inputmode="none" placeholder="0.00" readonly>
            <div style="text-align:center; color:var(--accent-color); margin:10px 0; font-size:24px;">‚áÖ</div>
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px;">
                <div style="text-align:center;"><input id="bhoriInput" class="big-input use-keypad" inputmode="none" style="font-size:18px; padding:10px;" placeholder="Vori" readonly><div style="font-size:9px; color:var(--text-sub)">1 = 11.664g</div></div>
                <div style="text-align:center;"><input id="anaInput" class="big-input use-keypad" inputmode="none" style="font-size:18px; padding:10px;" placeholder="Ana" readonly><div style="font-size:9px; color:var(--text-sub)">1 = 0.729g</div></div>
                <div style="text-align:center;"><input id="rattiInput" class="big-input use-keypad" inputmode="none" style="font-size:18px; padding:10px;" placeholder="Ratti" readonly><div style="font-size:9px; color:var(--text-sub)">1 = 0.121g</div></div>
            </div>
            <button class="t-btn" style="width:100%; margin-top:15px; background:var(--btn-bg); color:white; border:none; height:50px; border-radius:15px;" onclick="window.genConverterPDF()">DOWNLOAD PDF</button>
        </div>
    </div>

    <div id="page_gRateW" class="page-section">
        <div class="card">
            <div class="main-title">PRICE CALCULATOR</div>
            <input type="text" id="screenRate" class="big-input use-keypad" inputmode="none" placeholder="0.00" readonly>
            <div class="tab-group">
                <button id="btn22" class="t-btn" onclick="window.setTab('22')">22K</button>
                <button id="btn21" class="t-btn" onclick="window.setTab('21')">21K</button>
                <button id="btnBoth" class="t-btn active" onclick="window.setTab('both')">BOTH</button>
            </div>
            <div id="sec22">
                <div style="color:var(--color-22k); display:flex; justify-content:space-between; margin-bottom:8px; font-weight:bold;">22K GOLD <span id="p22Display">92.6%</span></div>
                <input type="text" id="w22" class="big-input use-keypad" inputmode="none" style="font-size:26px; margin-bottom:8px;" placeholder="Weight (g)" readonly>
                <div style="display:flex; justify-content:space-between; font-size:22px; color:var(--color-22k);"><span>Total:</span> <b id="t22">0.00</b></div>
            </div>
            <div id="sec21" style="margin-top:15px; border-top:1px dashed #444; padding-top:15px;">
                <div style="color:var(--color-21k); display:flex; justify-content:space-between; margin-bottom:8px; font-weight:bold;">21K GOLD <span id="p21Display">88.5%</span></div>
                <input type="text" id="w21" class="big-input use-keypad" inputmode="none" style="font-size:24px; margin-bottom:8px;" placeholder="Weight (g)" readonly>
                <div style="display:flex; justify-content:space-between; font-size:22px; color:var(--color-21k);"><span>Total:</span> <b id="t21">0.00</b></div>
            </div>
            <div style="margin-top:15px; background:rgba(255,255,255,0.03); border:1px solid #333; padding:15px; border-radius:18px; text-align:center;">
                <div id="grandTotal" style="font-size:38px; font-weight:bold; color:#fff;">0.00</div>
            </div>
            <input id="cName" class="big-input" style="font-size:16px; height:45px; margin-top:15px; text-align:left; padding:10px; background:rgba(0,0,0,0.3);" placeholder="Customer Name">
            <button class="t-btn" style="width:100%; margin-top:15px; background:var(--btn-bg); color:white; border:none; height:50px; border-radius:15px;" onclick="window.genPDF()">DOWNLOAD INVOICE PDF</button>
        </div>
    </div>
</div>

<div id="customKeypad">
    <div class="key-row"><button class="key-btn" onclick="window.pressKey('1')">1</button><button class="key-btn" onclick="window.pressKey('2')">2</button><button class="key-btn" onclick="window.pressKey('3')">3</button></div>
    <div class="key-row"><button class="key-btn" onclick="window.pressKey('4')">4</button><button class="key-btn" onclick="window.pressKey('5')">5</button><button class="key-btn" onclick="window.pressKey('6')">6</button></div>
    <div class="key-row"><button class="key-btn" onclick="window.pressKey('7')">7</button><button class="key-btn" onclick="window.pressKey('8')">8</button><button class="key-btn" onclick="window.pressKey('9')">9</button></div>
    <div class="key-row"><button class="key-btn" id="dotBtn" onclick="window.pressKey('.')">.</button><button class="key-btn" onclick="window.pressKey('0')">0</button><button class="key-btn" style="color:#ff4444" onclick="window.pressKey('BS')">‚å´</button></div>
    <button class="key-btn" style="width:100%; background:var(--accent-color); color:#000; font-size:18px; border:none; margin-top:10px;" onclick="window.closeKeypad()">DONE ‚ñº</button>
</div>

<!-- adminPanel, PDF modal, rest stays unchanged -->

<script>
    // ... everything unchanged up to window.initApp ...
    window.initApp = function() {
        const saved = localStorage.getItem('gold_pro_final_v20');
        if(saved) data = JSON.parse(saved);
        const root = document.documentElement;
        for (const [k, v] of Object.entries(data.theme)) root.style.setProperty(k, v);
        window.setTab('both');
        // Bind Keypad
        document.querySelectorAll('.use-keypad').forEach(i => {
            i.addEventListener('click', function(e) {
                e.preventDefault();
                activeInput = this;
                document.getElementById('customKeypad').classList.add('show');
                const app = document.getElementById('appMain');
                app.classList.add('keypad-active');
                // Only scroll .app-container, not viewport
                setTimeout(() => {
                    const rect = this.getBoundingClientRect();
                    const appRect = app.getBoundingClientRect();
                    const offset = (rect.top - appRect.top) - (app.clientHeight / 2) + (rect.height / 2);
                    app.scrollBy({ top: offset, behavior: 'smooth' });
                }, 300);
            });
        });
    };
    // ... rest of script unchanged ...
</script>
</body>
</html>