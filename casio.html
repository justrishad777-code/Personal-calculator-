<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Casio Calculator</title>
    <link href="https://fonts.cdnfonts.com/css/digital-7-mono" rel="stylesheet">
    
    <style>
        /* --- CASIO CSS START --- */
        :root { --primary: #ff9f43; --secondary: #0abde3; --bg-color: #f4f7f6; --text-main: #333; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; height: 100vh; overflow: hidden; background: #000; 
            font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; 
        }

        /* Top Bar */
        .top-bar { 
            height: 50px; background: #111; display: flex; align-items: center; padding: 0 15px; 
            border-bottom: 1px solid #333; color: white; justify-content: space-between;
        }
        .back-btn { text-decoration: none; color: white; font-size: 20px; font-weight: bold; }

        /* Screen */
        .screen { flex: 1; background: #000; padding: 15px; display: flex; flex-direction: column; position: relative; }
        .indicators { display: flex; justify-content: space-between; color: #555; height: 30px; }
        .step { font-family: monospace; color: var(--secondary); border: 1px solid #333; padding: 2px 6px; border-radius: 4px; }
        .op-display { text-align: right; color: var(--primary); font-size: 30px; height: 40px; font-family: monospace; }
        .main-display { flex: 1; display: flex; align-items: flex-end; justify-content: flex-end; overflow: hidden; }
        .main-text { font-family: 'Digital-7 Mono', monospace; color: #fff; font-size: 80px; line-height: 1; }

        /* Controls */
        .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px; background: #f4f7f6; }
        .c-btn { background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 14px; box-shadow: 0 3px 0 #ddd; cursor: pointer; color: #555; }
        .c-btn:active { transform: translateY(2px); box-shadow: none; }

        /* Keypad */
        .keypad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 10px 25px; background: #f4f7f6; flex-shrink: 0; }
        .k-btn { height: 60px; border-radius: 12px; border: 1px solid #ddd; background: #fff; font-size: 28px; font-weight: bold; color: #333; box-shadow: 0 4px 0 #ddd; cursor: pointer; }
        .k-btn:active { transform: translateY(3px); box-shadow: none; }
        .ac { color: #ff6b6b; } .op { color: var(--primary); } .eq { background: var(--primary); color: #fff; border: none; box-shadow: 0 4px 0 #e67e22; }

        /* Drawer */
        .drawer { position: absolute; bottom: -100%; left: 0; width: 100%; height: 70%; background: #222; z-index: 100; transition: 0.3s; color: #fff; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; }
        .drawer.open { bottom: 0; }
        .d-head { padding: 15px; border-bottom: 1px solid #444; display: flex; justify-content: space-between; }
        .d-body { flex: 1; overflow-y: auto; padding: 15px; }
        .d-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333; font-family: monospace; }
    </style>
</head>
<body onload="init()">

    <div class="top-bar">
        <a href="index.html" class="back-btn">â¬… Home</a>
        <span>Casio Pro</span>
        <div style="width: 50px;"></div>
    </div>

    <div class="screen">
        <div class="indicators">
            <span class="step" id="step">00</span>
            <span style="color:var(--primary); font-weight:bold; display:none;" id="mode">REV</span>
        </div>
        <div class="op-display" id="opDisp"></div>
        <div class="main-display">
            <span class="main-text" id="mainDisp">0</span>
        </div>
    </div>

    <div class="controls">
        <button class="c-btn" style="color:#0abde3" onclick="prev()">â—€ PREV</button>
        <button class="c-btn" style="color:#0abde3" onclick="next()">NEXT â–¶</button>
        <button class="c-btn" onclick="toggleDrawer()">ðŸ“œ List</button>
        <button class="c-btn" style="color:#ff9f43" onclick="correct()">CORR</button>
    </div>

    <div class="keypad">
        <button class="k-btn ac" onclick="AC()">AC</button>
        <button class="k-btn op" onclick="del()">âŒ«</button>
        <button class="k-btn op" onclick="op('%')">%</button>
        <button class="k-btn op" onclick="op('/')">Ã·</button>

        <button class="k-btn" onclick="num('7')">7</button>
        <button class="k-btn" onclick="num('8')">8</button>
        <button class="k-btn" onclick="num('9')">9</button>
        <button class="k-btn op" onclick="op('*')">Ã—</button>

        <button class="k-btn" onclick="num('4')">4</button>
        <button class="k-btn" onclick="num('5')">5</button>
        <button class="k-btn" onclick="num('6')">6</button>
        <button class="k-btn op" onclick="op('-')">âˆ’</button>

        <button class="k-btn" onclick="num('1')">1</button>
        <button class="k-btn" onclick="num('2')">2</button>
        <button class="k-btn" onclick="num('3')">3</button>
        <button class="k-btn op" onclick="op('+')">+</button>

        <button class="k-btn" onclick="num('00')">00</button>
        <button class="k-btn" onclick="num('0')">0</button>
        <button class="k-btn" onclick="num('.')">.</button>
        <button class="k-btn eq" onclick="eq()">=</button>
    </div>

    <div class="drawer" id="drawer">
        <div class="d-head">
            <span>History Tape</span>
            <span onclick="toggleDrawer()" style="cursor:pointer; color:red;">âœ• Close</span>
        </div>
        <div class="d-body" id="list"></div>
    </div>

    <script>
        /* --- CASIO LOGIC START --- */
        let tape = [], chain = [], input = "0";
        let idx = -1, edit = false, resShown = false, interim = false;
        const ui = { main: document.getElementById('mainDisp'), op: document.getElementById('opDisp'), step: document.getElementById('step'), list: document.getElementById('list') };

        function init() {
            // Load Theme from settings if available
            if(localStorage.getItem('gold_theme')) {
                const t = JSON.parse(localStorage.getItem('gold_theme'));
                if(t.primary) document.documentElement.style.setProperty('--primary', t.primary);
                if(t.secondary) document.documentElement.style.setProperty('--secondary', t.secondary);
            }
            if(localStorage.getItem('casio_data')) {
                try { tape = JSON.parse(localStorage.getItem('casio_data')); } catch(e) {}
            }
            render(); renderList();
        }

        function num(n) {
            if(edit) { if(input.length<12) input = (input==="0" && n!==".") ? n : input+n; render(); return; }
            if(idx !== -1) AC();
            if(resShown) { chain=[]; input="0"; resShown=false; }
            if(input.length<12) input = (input==="0" && n!==".") ? n : input+n;
            render();
        }

        function op(o) {
            if(edit) return;
            if(idx !== -1) AC();
            if(resShown) { chain=[{v:chain[chain.length-1].v, o:o}]; resShown=false; input=chain[0].v; }
            else if(input !== "") { chain.push({v:input, o:o}); input="0"; }
            
            // Interim Calc
            if(chain.length > 0) {
                try {
                    let expr = chain.reduce((a,c) => a + c.v + (c.o.replace('x','*').replace('Ã·','/')), "");
                    if("+-*/".includes(expr.slice(-1))) expr = expr.slice(0,-1);
                    input = String(eval(expr)); interim = true;
                } catch(e){}
            }
            render();
        }

        function eq() {
            if(edit) { finishCorr(); return; }
            if(idx !== -1) return;
            chain.push({v:input, o:'='});
            let expr = chain.reduce((a,c) => a + c.v + (c.o==='='?'':c.o.replace('x','*').replace('Ã·','/')), "");
            let res = eval(expr);
            chain.push({v:String(res), o:'ANS'});
            tape.push([...chain]); save();
            resShown = true; input = String(res); chain = [{v:String(res), o:'='}]; // Reset chain slightly
            render(); renderList();
        }

        function AC() { chain=[]; input="0"; idx=-1; edit=false; resShown=false; render(); }
        function del() { input = input.slice(0,-1)||"0"; render(); }
        
        function prev() { if(tape.length && idx===-1) { chain=tape[tape.length-1]; idx=chain.length-1; } else if(idx>0) idx--; render(); }
        function next() { if(idx!==-1 && idx<chain.length-1) idx++; render(); }
        
        function correct() { if(idx!==-1 && chain[idx].o!=='ANS') { edit=true; input=chain[idx].v; render(); } }
        function finishCorr() {
            chain[idx].v = input;
            // Recalculate
            let newChain = chain.slice(0, chain.length-1); // Remove ANS
            let expr = newChain.reduce((a,c) => a + c.v + (c.o==='='?'':c.o), "");
            let res = eval(expr);
            newChain.push({v:String(res), o:'ANS'});
            chain = newChain; tape[tape.length-1] = chain; save();
            edit=false; input="0"; render(); renderList();
        }

        function render() {
            let dV = input, dO = "";
            if(edit) { dV = input; dO = "EDIT"; }
            else if(idx!==-1) { dV = chain[idx].v; dO = chain[idx].o; }
            else if(chain.length) { dO = chain[chain.length-1].o; }
            
            ui.main.innerText = parseFloat(dV).toLocaleString();
            ui.op.innerText = dO==='='?'':dO.replace('*','Ã—').replace('/','Ã·');
            ui.step.innerText = (idx!==-1 ? idx+1 : chain.length).toString().padStart(2,'0');
            resize();
        }

        function resize() {
            let s = 80; ui.main.style.fontSize = s+"px";
            while(ui.main.scrollWidth > ui.main.parentElement.clientWidth && s>30) { s-=5; ui.main.style.fontSize=s+"px"; }
        }

        function save() { localStorage.setItem('casio_data', JSON.stringify(tape)); }
        function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
        function renderList() {
            ui.list.innerHTML = tape.map(t => {
                let e = t.reduce((a,c) => c.o==='ANS'?'':a+c.v+c.o, "");
                let r = t[t.length-1].v;
                return `<div class="d-row"><span>${e}</span><b>${parseFloat(r).toLocaleString()}</b></div>`;
            }).reverse().join('');
        }
    </script>
</body>
</html>
